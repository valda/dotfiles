# タスク同期・更新コマンド (/sync-todos)

## 概要
プロジェクトのタスク管理ファイルを同期・更新し、選択された作業コンテキストに応じて適切なファイルに進捗状況と得られた知見を記録する

## 実行タイミング
- 作業完了時
- 新しい課題や問題を発見した時
- セッション終了前
- 重要な進捗があった時
- コンテキスト間でタスクを移動する時

## 実行手順

**注意**: 以下のbashコマンド例は、LLMが実行すべき処理フローを表したものです。実際にはClaude Codeが適切なファイルを読み込み、内容を解析してユーザーに提示します。

### 1. 作業コンテキストの確認と適応的管理
**LLMが実行すべき処理**:
- ユーザーに現在の作業コンテキストを確認
- 既存のコンテキストを動的に表示
- 適切なコンテキストがない場合は新規作成を提案

```bash
# 処理フローの例（LLMが内部的に実行）
echo "今回のセッションで作業したコンテキストを教えてください："
echo ""
echo "既存のコンテキスト:"

# 既存コンテキストを動的に検出して表示
if [ -d "docs/todo/contexts" ]; then
    for context_file in docs/todo/contexts/*.md; do
        if [ -f "$context_file" ]; then
            context_name=$(basename "$context_file" .md)
            echo "  📂 $context_name"
        fi
    done
fi

echo ""
echo "➕ 新しいコンテキストを作成"
echo ""
echo "どのコンテキストに記録しますか？"
echo "（既存のコンテキスト名、または 'new' で新規作成）"
```

#### 新規コンテキスト作成フロー
ユーザーが "new" を選択した場合：
```
📝 **新しいコンテキストを作成します**

このセッションで作業した内容に適したコンテキスト名を入力してください:

推奨例:
- backend, frontend, mobile-app
- data-pipeline, ml-training, analytics
- admin-panel, user-api, payment-system
- infrastructure, devops, monitoring

コンテキスト名: [ユーザー入力待ち]
```

新規作成確認：
```
📱 「[入力されたコンテキスト名]」コンテキストを作成しますか？

作成されるファイル:
- contexts/[コンテキスト名].md
- knowledge/[コンテキスト名]-learnings.md

Y) 作成して記録を続行
N) 既存コンテキストから選択
E) コンテキスト名を編集
```

### 2. TODOディレクトリ構成の確認
**LLMが実行すべき処理**:
- 新しいファイル構成ディレクトリの存在確認
- 必要に応じてディレクトリ作成の提案

```bash
# 処理フローの例（LLMが内部的に実行）
# 新しいファイル構成の確認と作成
mkdir -p docs/todo/contexts
mkdir -p docs/todo/knowledge
mkdir -p docs/todo/archive/$(date +%Y-%m)

# LLMが ls -la docs/todo/ の代わりにディレクトリ構成を確認
```

### 3. コンテキスト別ファイルの確認
**LLMが実行すべき処理**:
- 選択されたコンテキストに応じて、対応するファイルを確認
- 新規作成の場合は適切なテンプレートでファイルを作成

選択されたコンテキストに応じて、対応するファイルを確認：
- **[任意のコンテキスト]**: `contexts/[コンテキスト名].md` + `knowledge/[コンテキスト名]-learnings.md`
- **汎用デバッグ**: `knowledge/debug-patterns.md`

#### 新規コンテキストファイル作成テンプレート
```markdown
# [コンテキスト名] Tasks

作成日: [YYYY-MM-DD]
最終更新: [YYYY-MM-DD]

## 🔥 緊急タスク

## ⚠️ 重要タスク

## 📝 一般タスク

## ✅ 完了したタスク

## 📋 メモ・注意事項
```

```markdown
# [コンテキスト名] 学習記録

作成日: [YYYY-MM-DD]

## 学習履歴
（今後のセッションで追加されます）
```

### 4. ユーザーとの対話で更新
1. **完了したタスクの確認**
   - 「今回のセッションで完了したタスクはありますか？」
   - 完了項目を `✅ 完了` または `~~取り消し線~~` でマーク
   - 必要に応じて `archive/` に移動

2. **新規課題の追加**
   - 「新しく発見した問題や追加すべきタスクはありますか？」
   - 適切な優先度（🔥高、⚠️中、📝低）を設定
   - 適切なコンテキストファイルに追加

3. **進行中タスクの状況更新**
   - 「進行中のタスクで状況変更があるものはありますか？」
   - 進捗状況や追加情報を記録

4. **コンテキスト間のタスク移動**
   - 「他のコンテキストに移動すべきタスクはありますか？」
   - 例：コンテキストA → コンテキストB、分離すべきタスクの特定

### 5. コンテキスト別知見の記録
セッション中に得た重要な情報を、適切なコンテキスト別ファイルに記録：

#### A. 技術的知見の記録
**各コンテキスト関連** (`knowledge/[コンテキスト名]-learnings.md`)

```markdown
## [YYYY-MM-DD] [コンテキスト名] セッション学習記録

### ✅ 成功したアプローチ
- 具体的な解決方法
- 使用したツール・ライブラリ・フレームワーク
- 効果的だった設計パターン・アーキテクチャ選択

### ❌ 失敗したアプローチ
- 試したが上手くいかなかった方法
- 失敗の原因分析（技術的制約・設計判断・外部要因など）
- 今後避けるべきポイント

### 🔍 重要な発見・気づき
- プロジェクト固有の制約や特性
- パフォーマンス改善のヒント
- 設計上の重要な判断基準・ベストプラクティス
```

#### B. 汎用デバッグログの記録 (`knowledge/debug-patterns.md`)
```markdown
## [YYYY-MM-DD] [コンテキスト] デバッグ・試行錯誤ログ

### 問題: [問題の概要]
**コンテキスト**: [選択されたコンテキスト名]
**症状**:
**原因調査プロセス**:
1. 最初に疑った原因 → 結果
2. 次に試したアプローチ → 結果
3. 最終的な解決方法

**学んだこと**:
**次回の改善点**:
**関連するコンテキスト**: [他のコンテキストでも応用可能か]
**コンテキスト固有の注意点**: [そのコンテキスト特有の制約や考慮事項]
```

### 6. index.md の更新
軽量索引ファイルを最新状態に同期：

```markdown
# プロジェクト TODO 索引

最終更新: [YYYY-MM-DD HH:MM]

## 📊 コンテキスト別状況サマリー

### 🔥 Infrastructure (緊急度: 高)
- アクティブなタスク: X件
- 完了待ち: Y件
- 最新の課題: [簡潔な1行説明]

### 🔥 [コンテキスト1] (緊急度: 高)
- アクティブなタスク: X件
- 完了待ち: Y件
- 最新の課題: [簡潔な1行説明]

### 🎯 [コンテキスト2] (緊急度: 中)
- アクティブなタスク: X件
- 完了待ち: Y件
- 最新の課題: [簡潔な1行説明]

### 📝 [コンテキスト3] (緊急度: 低)
- アクティブなタスク: X件
- 完了待ち: Y件
- 最新の課題: [簡潔な1行説明]

**注意**: コンテキスト名と絵文字は実際のプロジェクト構成に応じて動的に決定

## 🚨 緊急対応が必要な項目
- [最優先で対応すべき課題があれば記載]

## 📅 今週の目標
- [今週中に完了予定のマイルストーン]
```
- 各ファイルの内容を日本語で更新
- タイムスタンプと更新者情報を記録
- **セッション知見を必ず記録すること**
- 変更履歴をコミット推奨

### 7. ファイル更新の実行
**LLMが実行すべき処理**:
- 各ファイルの内容を日本語で更新
- タイムスタンプと更新者情報を記録
- 選択されたコンテキストに応じた適切なファイルに保存
- セッション知見を必ず記録すること
- 変更履歴をコミット推奨

### 8. ナレッジ記録の促進（コンテキスト別）
セッション終了時に以下を確認：
1. **「今回のセッションで学んだ重要なことはありますか？」**
2. **「失敗したアプローチや避けるべき方法はありましたか？」**
3. **「デバッグで時間がかかった問題はありましたか？」**
4. **「他のコンテキストでも応用できる知見はありますか？」**
5. **「このコンテキストに関連する新しいパターンを発見しましたか？」**

## 出力形式
すべての出力とファイル内容は日本語で記述すること

## 注意事項
- セッション終了前に必ず実行することを推奨
- 重要な課題は必ず適切な優先度を設定
- **コンテキスト別にファイルを分散管理**して軽量化を維持
- **適切なコンテキストがない場合は新規作成**してプロジェクトに最適化
- **知見・失敗・試行錯誤の記録は必須** - 将来の開発効率向上のため
- 小さな発見でも記録することで、コンテキスト別ナレッジベースを構築
- セッション開始時は `/check-todos` コマンドと組み合わせて使用
- **index.md の更新**で次回のセッション開始を高速化
- コンテキストを跨ぐ知見は複数のファイルに記録することを検討
- **グローバルコマンド設計**: プロジェクト固有のコンテキストに依存しない汎用性を保持
